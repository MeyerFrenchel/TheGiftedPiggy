---
interface Props {
  title: string;
}

const { title } = Astro.props;
const supabaseAnonKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;
const { profile } = Astro.locals;
const pathname = new URL(Astro.request.url).pathname;

const navLinks = [
  { href: '/admin', label: 'Dashboard', icon: '‚ñ¶' },
  { href: '/admin/products', label: 'Products', icon: 'üéÅ' },
];
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex, nofollow" />
    <title>{title} ‚Äî Admin ¬∑ The Gifted Piggy</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="supabase-anon-key" content={supabaseAnonKey} />
    <style>
      *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
      :root { --sidebar-w: 220px; }
      body {
        font-family: Inter, system-ui, -apple-system, sans-serif;
        background: #f8f8f8;
        color: #1a1a1a;
        min-height: 100vh;
        display: flex;
      }

      /* ‚îÄ‚îÄ Overlay (mobile only) ‚îÄ‚îÄ */
      .sidebar-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.45);
        z-index: 15;
      }
      .sidebar-overlay.open { display: block; }

      /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
      aside {
        width: var(--sidebar-w);
        background: #1e1b2e;
        color: #d1c9f0;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        position: fixed;
        top: 0; left: 0; bottom: 0;
        z-index: 20;
        transition: transform 0.25s ease;
      }
      .sidebar-brand {
        padding: 1.25rem 1.5rem;
        font-size: 1rem;
        font-weight: 700;
        color: #fff;
        border-bottom: 1px solid rgba(255,255,255,0.08);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.5rem;
      }
      .sidebar-close {
        display: none;
        background: none;
        border: none;
        color: #c4bbea;
        cursor: pointer;
        font-size: 1.25rem;
        line-height: 1;
        padding: 0.25rem;
      }
      nav { padding: 1rem 0.75rem; flex: 1; }
      nav a {
        display: flex;
        align-items: center;
        gap: 0.625rem;
        padding: 0.625rem 0.75rem;
        border-radius: 6px;
        color: #c4bbea;
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 500;
        transition: background 0.15s, color 0.15s;
        margin-bottom: 2px;
      }
      nav a:hover { background: rgba(255,255,255,0.07); color: #fff; }
      nav a.active { background: rgba(139,92,246,0.3); color: #d8b4fe; }
      .sidebar-footer {
        padding: 1rem 1.5rem;
        border-top: 1px solid rgba(255,255,255,0.08);
        font-size: 0.75rem;
        color: #8e86b3;
      }
      .sidebar-footer .email { font-weight: 600; color: #c4bbea; margin-bottom: 0.5rem; word-break: break-all; }
      .logout-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.375rem 0.75rem;
        border: 1px solid rgba(255,255,255,0.15);
        border-radius: 4px;
        background: transparent;
        color: #c4bbea;
        font-size: 0.75rem;
        cursor: pointer;
        text-decoration: none;
        transition: background 0.15s;
        margin-top: 0.5rem;
        width: 100%;
        justify-content: center;
      }
      .logout-btn:hover { background: rgba(255,255,255,0.07); color: #fff; }

      /* ‚îÄ‚îÄ Main ‚îÄ‚îÄ */
      main {
        margin-left: var(--sidebar-w);
        flex: 1;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        min-width: 0;
      }
      .top-bar {
        background: #fff;
        border-bottom: 1px solid #e5e7eb;
        padding: 1rem 1.75rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      .top-bar h1 { font-size: 1.125rem; font-weight: 600; color: #111; flex: 1; }
      .hamburger {
        display: none;
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.25rem;
        color: #374151;
        font-size: 1.35rem;
        line-height: 1;
        flex-shrink: 0;
      }
      .content { padding: 1.75rem; flex: 1; }

      /* ‚îÄ‚îÄ Mobile ‚îÄ‚îÄ */
      @media (max-width: 767px) {
        aside {
          transform: translateX(-100%);
        }
        aside.open {
          transform: translateX(0);
        }
        .sidebar-close { display: block; }
        main { margin-left: 0; }
        .hamburger { display: flex; align-items: center; justify-content: center; }
        .top-bar { padding: 0.875rem 1rem; }
        .content { padding: 1rem; }
      }
    </style>
  </head>
  <body>
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <aside id="sidebar">
      <div class="sidebar-brand">
        <span>üê∑ Gifted Piggy</span>
        <button class="sidebar-close" id="sidebar-close" aria-label="Close menu">‚úï</button>
      </div>
      <nav>
        {navLinks.map((link) => (
          <a
            href={link.href}
            class={pathname === link.href || (link.href !== '/admin' && pathname.startsWith(link.href)) ? 'active' : ''}
          >
            <span aria-hidden="true">{link.icon}</span>
            {link.label}
          </a>
        ))}
      </nav>
      <div class="sidebar-footer">
        {profile && <div class="email">{profile.email}</div>}
        <form action="/admin/login" method="post">
          <input type="hidden" name="action" value="logout" />
          <button type="submit" class="logout-btn">‚Ü© Sign out</button>
        </form>
      </div>
    </aside>

    <main>
      <div class="top-bar">
        <button class="hamburger" id="hamburger" aria-label="Open menu">‚ò∞</button>
        <h1>{title}</h1>
      </div>
      <div class="content">
        <slot />
      </div>
    </main>

    <script>
      const hamburger = document.getElementById('hamburger');
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      const closeBtn = document.getElementById('sidebar-close');

      function open() {
        sidebar!.classList.add('open');
        overlay!.classList.add('open');
        document.body.style.overflow = 'hidden';
      }
      function close() {
        sidebar!.classList.remove('open');
        overlay!.classList.remove('open');
        document.body.style.overflow = '';
      }

      hamburger!.addEventListener('click', open);
      overlay!.addEventListener('click', close);
      closeBtn!.addEventListener('click', close);

      // Close on nav link click (navigating away)
      sidebar!.querySelectorAll('nav a').forEach(a => a.addEventListener('click', close));
    </script>
  </body>
</html>
