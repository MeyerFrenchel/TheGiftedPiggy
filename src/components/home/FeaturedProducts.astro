---
import SectionHeading from "@components/ui/SectionHeading.astro";
import ProductCard from "@components/products/ProductCard.astro";
import Button from "@components/ui/Button.astro";
import { useTranslations } from "@i18n/utils";
import type { Lang } from "@i18n/ui";
import { createServiceClient } from "@lib/supabase";

interface Props {
  lang?: Lang;
}

const { lang = "ro" } = Astro.props;
const t = useTranslations(lang);

const supabase = createServiceClient();
const { data: featured } = await supabase
  .from("products")
  .select("*")
  .eq("featured", true)
  .eq("in_stock", true)
  .limit(4);
---

{
  (featured ?? []).length > 0 && (
    <section class="py-16" aria-label={t("products.featured")}>
      <div class="container mx-auto px-4">
        <SectionHeading
          title={t("products.featured")}
          subtitle={t("products.subtitle")}
        />
        <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
          {(featured ?? []).map((product) => (
            <ProductCard {product} {lang} />
          ))}
        </div>
        <div class="mt-10 text-center">
          <Button
            href={lang === "en" ? "/en/products" : "/produse"}
            variant="outline"
            size="lg"
          >
            {t("products.all")} â†’
          </Button>
        </div>
      </div>
    </section>
  )
}
