---
import { Image } from "astro:assets";
import Badge from "@components/ui/Badge.astro";
import { useTranslations } from "@i18n/utils";
import type { Lang } from "@i18n/ui";
import type { CollectionEntry } from "astro:content";

interface Props {
  post: CollectionEntry<"blog">;
  lang?: Lang;
}

const { post, lang = "ro" } = Astro.props;
const t = useTranslations(lang);
const { title, description, pubDate, heroImage, heroImageAlt, tags, author } = post.data;

const href = lang === "en" ? `/en/blog/${post.slug}` : `/blog/${post.slug}`;

const formattedDate = pubDate.toLocaleDateString(lang === "ro" ? "ro-RO" : "en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<article
  class="group bg-card rounded-[var(--radius-lg)] border border-theme overflow-hidden card-hover"
>
  <a href={href} class="block" aria-label={title}>
    {
      heroImage ? (
        <div class="overflow-hidden aspect-[16/9]">
          <Image
            src={heroImage}
            alt={heroImageAlt ?? title}
            width={400}
            height={225}
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
            loading="lazy"
          />
        </div>
      ) : (
        <div class="aspect-[16/9] bg-[var(--color-blush)] flex items-center justify-center">
          <span class="text-4xl" aria-hidden="true">üê∑</span>
        </div>
      )
    }
    <div class="p-5">
      {
        tags && tags.length > 0 && (
          <div class="flex flex-wrap gap-1.5 mb-3">
            {tags.slice(0, 3).map((tag) => (
              <Badge variant="terracotta">{tag}</Badge>
            ))}
          </div>
        )
      }
      <h2
        class="text-lg font-semibold text-primary mb-2 group-hover:text-terracotta transition-colors line-clamp-2"
        style="font-family: var(--font-heading);"
      >
        {title}
      </h2>
      {
        description && (
          <p class="text-sm text-muted line-clamp-3 mb-4">{description}</p>
        )
      }
      <div class="flex items-center justify-between text-xs text-muted">
        <time datetime={pubDate.toISOString()}>{formattedDate}</time>
        <span class="text-terracotta font-medium">{t("blog.readMore")} ‚Üí</span>
      </div>
    </div>
  </a>
</article>
